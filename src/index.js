////////////////////////////////////////////////////////////////////////////////
// REQUIRES : BEGIN
////////////////////////////////////////////////////////////////////////////////

import isObject from 'lodash-compat/lang/isObject';
import { setDefaultOptions } from './options';
import { getInitial, getSubSchema } from './helper';

import ValidationError from './error';
import { Type, Presence } from './enums';

import Sculp from './sculp';

////////////////////////////////////////////////////////////////////////////////
// REQUIRES : END
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// tryValidate static
////////////////////////////////////////////////////////////////////////////////

export function tryValidate (value, schema, options = {}) {
  // eslint-disable-next-line prefer-rest-params
  if (arguments.length >= 4 || arguments.length < 2)
    throw new Error('Validate function expects 2 or 3 arguments');
  if (options != null && isObject(options) === false)
    throw new Error('Options argument should be an object');

  const sculp = new Sculp(value, schema, {
    ...options,
    disableDependencyTracking : true
  });
  return sculp.tryValidate();
}

////////////////////////////////////////////////////////////////////////////////
// validate static
////////////////////////////////////////////////////////////////////////////////

export function validate (value, schema, options = {}) {
  // eslint-disable-next-line prefer-rest-params
  if (arguments.length >= 4 || arguments.length < 2)
    throw new Error('Validate function expects 2 or 3 arguments');
  if (options != null && isObject(options) === false)
    throw new Error('Options argument should be an object');

  const sculp = new Sculp(value, schema, {
    ...options,
    disableDependencyTracking : true
  });
  return sculp.validate();
}

////////////////////////////////////////////////////////////////////////////////
// getSchemaValue static
////////////////////////////////////////////////////////////////////////////////

export function getSchemaValue (schema, value, path, rule) {
  const sculp = new Sculp(value, schema, { disableDependencyTracking : true });
  return sculp.getSchemaValue(path, rule);
}

// old function name
export { getSchemaValue as getSchemeValue };

////////////////////////////////////////////////////////////////////////////////
// getFieldName static
////////////////////////////////////////////////////////////////////////////////

export function getFieldName (schema, value, path) {
  const sculp = new Sculp(value, schema, { disableDependencyTracking : true });
  return sculp.getFieldName(path);
}

////////////////////////////////////////////////////////////////////////////////
// getFieldPresence static
////////////////////////////////////////////////////////////////////////////////

export function getFieldPresence (schema, value, path) {
  const sculp = new Sculp(value, schema, { disableDependencyTracking : true });
  return sculp.getFieldPresence(path);
}

////////////////////////////////////////////////////////////////////////////////
// setDefaultOptions static
////////////////////////////////////////////////////////////////////////////////

export { setDefaultOptions };

////////////////////////////////////////////////////////////////////////////////
// getInitial & getSubSchema static
////////////////////////////////////////////////////////////////////////////////

export { getInitial, getSubSchema };

// old function name
export { getSubSchema as getSubScheme };

////////////////////////////////////////////////////////////////////////////////
// Error and enums
////////////////////////////////////////////////////////////////////////////////

export { ValidationError, Type, Presence };

////////////////////////////////////////////////////////////////////////////////
// export
////////////////////////////////////////////////////////////////////////////////

export { Sculp };
