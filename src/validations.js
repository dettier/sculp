////////////////////////////////////////////////////////////////////////////////
// REQUIRES : BEGIN
////////////////////////////////////////////////////////////////////////////////

import { getMessage } from './i18n/lang';

import isRegExp from 'lodash-compat/lang/isRegExp';
import isNumber from 'lodash-compat/lang/isNumber';
import contains from 'lodash-compat/collection/contains';

import { Presence } from './enums';

////////////////////////////////////////////////////////////////////////////////
// REQUIRES : END
////////////////////////////////////////////////////////////////////////////////

const validations = {

  //////////////////////////////////////////////////////////////////////////////
  // values
  //////////////////////////////////////////////////////////////////////////////

  values (fieldAccessor, rule) {
    if (!contains(rule, fieldAccessor())) {
      return getMessage('INVALID_VALUE_ERROR');
    }

    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // regexp
  //////////////////////////////////////////////////////////////////////////////

  regexp (fieldAccessor, rule) {
    if (!isRegExp(rule)) {
      rule = new RegExp(rule);
    }

    if (rule.test(fieldAccessor()) === false) {
      return getMessage('INVALID_VALUE_ERROR');
    }

    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // length
  //////////////////////////////////////////////////////////////////////////////

  length (fieldAccessor, rule) {
    const value = fieldAccessor();
    const length = value && value.length;
    if ((rule.min != null) && length < rule.min) {
      return getMessage('LENGTH_MIN_ERROR', { length : rule.min });
    } else if ((rule.max != null) && length > rule.max) {
      return getMessage('LENGTH_MAX_ERROR', { length : rule.max });
    } else if (isNumber(rule) && length !== rule) {
      return getMessage('LENGTH_NE_ERROR', { length : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // lengthmin
  //////////////////////////////////////////////////////////////////////////////

  lengthmin (fieldAccessor, rule) {
    const value = fieldAccessor();
    const length = value && value.length;
    if (length < rule) {
      return getMessage('LENGTH_MIN_ERROR', { length : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // lengthmax
  //////////////////////////////////////////////////////////////////////////////

  lengthmax (fieldAccessor, rule) {
    const value = fieldAccessor();
    const length = value && value.length;
    if (length > rule) {
      return getMessage('LENGTH_MAX_ERROR', { length : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // min
  //////////////////////////////////////////////////////////////////////////////

  min (fieldAccessor, rule) {
    if (fieldAccessor() < rule) {
      return getMessage('MIN_ERROR', { value : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // max
  //////////////////////////////////////////////////////////////////////////////

  max (fieldAccessor, rule) {
    if (fieldAccessor() > rule) {
      return getMessage('MAX_ERROR', { value : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // ne
  //////////////////////////////////////////////////////////////////////////////

  ne (fieldAccessor, rule) {
    if (fieldAccessor() === rule) {
      return getMessage('NE_ERROR', { value : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // gt
  //////////////////////////////////////////////////////////////////////////////

  gt (fieldAccessor, rule) {
    if (fieldAccessor() <= rule) {
      return getMessage('GT_ERROR', { value : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // lt
  //////////////////////////////////////////////////////////////////////////////

  lt (fieldAccessor, rule) {
    if (fieldAccessor() >= rule) {
      return getMessage('LT_ERROR', { value : rule });
    }
    return undefined;
  },

  //////////////////////////////////////////////////////////////////////////////
  // presence
  //////////////////////////////////////////////////////////////////////////////

  presence (fieldAccessor, rule) {
    const value = fieldAccessor();
    if (rule === Presence.REQUIRED && !(value != null)) {
      return getMessage('PRESENCE_REQUIRED_ERROR');
    } else if (rule === Presence.ABSENT && (value != null)) {
      return getMessage('PRESENCE_ABSENT_ERROR');
    }
    return undefined;
  }
};

////////////////////////////////////////////////////////////////////////////////
// export
////////////////////////////////////////////////////////////////////////////////

export default validations;
